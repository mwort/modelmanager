{% extends "admin/change_list.html" %}

{% block extrastyle %}
  {{ block.super }}
<style media="screen">
  #container {
    min-width: 0;
  }
  #content {
    padding: 20px;
  }
  #content-main {
    width: 39%;
    min-width: 440px;
  }
  #content-results {
    float: right;
    width: 59%;
    min-width: 440px;
  }
  #results {
    text-align: center;
    vertical-align: middle;
    margin: 20px;
  }
  input[type="button"] {
    padding: 2px 8px;
  }
</style>
{% endblock %}


{% block content %}
{{ block.super }}

<div id="content-results" class="module">
  <h2>Results</h2>
  <div id="results">
    <h5>Select configured function.</h5>
  </div>
</div>

<script type="text/javascript">

var loaded_results = {}

django.jQuery("input[value='Run']").click(function(e) {
    e.preventDefault();
    var reselem = django.jQuery('#results');
    var id = django.jQuery(this).attr('name');
    if (loaded_results[id]) {
      reselem.html(loaded_results[id]);
    } else {
      reselem.html('<h5>Thinking...</h5>');
      django.jQuery.ajax({url:  id + '/change/call/', // will be appended to current url
                          async: true,
                          success: function(d) {
                            reselem.html(d);
                            loaded_results[id] = d;
                          },
                          error: function (e) {
                            console.log(e);
                            reselem.html('<h5>Something went wrong.</h5>')
                          }
        });
    }
});
</script>
{% endblock %}
